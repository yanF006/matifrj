<%- include ('partials/header.ejs'); %>
<link rel="stylesheet" href="/CSS/cargos.css">
<title>Sistema de Adm</title>
<body>
    <%- include ('partials/navbar-admin.ejs'); %>
    <div class="container mt-4">
        <h1>Cargos</h1>
        <div class="card p-4">
            <h2 class="mb-3">Gerenciar Cargos</h2>
            <form id="adminForm" action="/buscar" method="GET">
                <div class="mb-3">
                    <label for="q" class="form-label">Nome de Usuário</label>
                    <div class="search-container">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" class="form-control" id="q" name="q" placeholder="Buscar...">
                        
                    </div>
                    <button type="submit" class=" mt-1 btn btn-success">Buscar</button>
                </div>
            </form>
            <div class="mt-4">
                <h3>Usuários</h3>
                <ul class="list-group" id="adminList">   
                    <% if (usuario.length > 0) { %>
                        <% usuario.forEach(user => { %>
                            <% if (user.role == 1) { %>
                                <li class="adm list-group-item d-flex justify-content-between align-items-center"><p class="nome-adm"><%- user.name %></p><div><button class="btn-func btn btn-danger mx-2" data-id="<%- user.id %>" data-role="0">Tornar usuário comum</button></div></li>
                                <% } else { %>
                                    <li class="adm list-group-item d-flex justify-content-between align-items-center"><p class="nome-adm"><%- user.name %></p><div><button class="btn-func btn btn-success mx-2" data-id="<%- user.id %>" data-role="1" >Tornar administrador</button></div></li>
    
                                    <% } %>
                           
                        <% }) %>
                      <% } else { %>
                        <p>Nenhum usuário encontrado.</p>
                      <% } %>
                    
                </ul>
            </div>

            
        </div>
        
    </div>
    
        <script>
    document.addEventListener('DOMContentLoaded', () => {
        const buttons = document.querySelectorAll('.btn-func');

        buttons.forEach(button => {
            button.addEventListener('click', async () => {
                const userId = button.getAttribute('data-id');
                const newRole = button.getAttribute('data-role');

                try {
                    const response = await fetch('/update-role', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ id: userId, role: newRole })
                    });

                    if (response.ok) {
                        // Atualize a interface conforme necessário
                        alert('Cargo atualizado com sucesso!');
                        location.reload(); // Atualiza a página para refletir a mudança
                    } else {
                        alert('Erro ao atualizar cargo.');
                    }
                } catch (error) {
                    console.error('Erro ao enviar requisição:', error);
                }
            });
        });
    });
</script>

    
    <script src="/JS/cargos.js"></script>
    <script src="/JS/script.js"></script>
</body>
<%- include ('partials/footer.ejs'); %>
